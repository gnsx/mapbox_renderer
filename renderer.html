<!DOCTYPEhtml>
<html>

<head>
    <metacharset=utf-8/>
    <title>LeafletLabel</title>
    <metaname='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <scriptsrc="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
        </script>
        <scriptsrc='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js'>
            </script>
            <linkhref='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css' rel='stylesheet' />
            <style>
                body {
                    margin: 0;
                    padding: 0;
                }

                #map {
                    position: relative;
                    height: 700px;
                    top: 0;
                    bottom: 0;
                    width: 100%;
                }
            </style>
            <script>
                $(window).resize(function() {
                    $('#map').height($(window).height() / 1.1);
                });
                $(window).trigger('resize');
            </script>
            <script>
                $(window).ready(function() {
                    $('#map').height($(window).height() / 1.1);
                });
            </script>
</head>

<body>
    <scriptsrc='https://api.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.js'>
        </script>
        <linkhref='https://api.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.css' rel='stylesheet' />
        <divid='map'>
            </div>
            <inputtype='file' accept='text/plain' onchange='openFile(event)'><br>
                <imgid='output'>
                    <script>
                        L.mapbox.accessToken = 'pk.eyJ1IjoicGVnYXN1cyIsImEiOiJjaWd1bjlvdmIwN3Izd3dtMDluYW1lMGlrIn0.QTR6xEpvu5bsXGeYn5jgjg';
                        varmap = L.mapbox.map('map', 'mapbox.streets', {
                            center: [21.162672, 79.087958],
                            zoom: 5
                        });
                        varopenFile = function(event) {
                                varinput = event.target;
                                varreader = newFileReader();
                                reader.onload = function() {
                                        vartext = reader.result;
                                        varline_points = [];
                                        varres = text.split("\n");
                                        console.log("Length of file " + res.length);
                                        for (i = 0; i < res.length; i++) {
                                            console.log("Pass" + i);
                                            if (res[i] != "") {
                                                varinside_array = res[i].split(","); /*if(x_first_pass===true){angle_x=inside_array[1];angle_y=inside_array[2];x_first_pass=false;}*/ //vararr1=newL.LatLng(kalmanFilterX(inside_array[1],0.00000001),kalmanFilterY(inside_array[2],0.00000001));vararr1=newL.LatLng(inside_array[1],inside_array[2]);console.log("Lat:"+inside_array[1]+"Lon "+inside_array[2]);line_points.push(arr1);}}varpolyline_options={color:'#000'};L.polyline(line_points).addTo(map);};reader.readAsText(input.files[0]);varx_first_pass=true;vary_first_pass=true;varQ_angle_x=0.001;varQ_bias_x=0.000001;varR_measure_x=0.95;//0.03varbias_x=0;//varP_x[2][2];varP_x=[[0.0,0.0],[0.0,0.0]];vardt1=0.004;varK_x=[0.0,0.0];varangle_x=15.382528;//15.5018330;//newNumber(0.0);//15.5018330varq_bias_x=0.0;varrate_x=0.0;vary_x=0.0,S_x=0.0;varQ_angle_y=0.001;varQ_bias_y=0.000001;varR_measure_y=0.95;//0.03varbias_y=0;//varP_x[2][2];varP_y=[[0.0,0.0],[0.0,0.0]];varK_y=[0.0,0.0];varangle_y=74.141558;//73.8246320;//newNumber(0.0);//73.8246320;varq_bias_y=0.0;varrate_y=0.0;vary_y=0.0,S_y=0.0;varkalmanFilterX=function(newAngle_x,newRate_x){console.log(x_first_pass);/*if(x_first_pass){//angle_x=newAngle_x;console.log(angle_x);x_first_pass=false;return(angle_x);}*///else{/*Step1*/rate_x=newRate_x-bias_x;angle_x=angle_x+(dt1*rate_x);//console.log("P00:"+P_x[0/*Step2*/P_x[0][0]+=dt1*(dt1*P_x[1][1]-P_x[0][1]-P_x[1][0]+Q_angle_x);P_x[0][1]-=dt1*P_x[1][1];P_x[1][0]-=dt1*P_x[1][1];P_x[1][1]+=Q_bias_x*dt1;/*Step3*/y_x=newAngle_x-angle_x;/*Step4*/S_x=P_x[0][0]+R_measure_x;/*Step5*/K_x[0]=P_x[0][0]/S_x;K_x[1]=P_x[1][0]/S_x;y_x=newAngle_x-angle_x;/*Step6*/angle_x+=K_x[0]*y_x;bias_x+=K_x[1]*y_x;/*Step7*/P_x[0][0]-=K_x[0]*P_x[0][0];P_x[0][1]-=K_x[0]*P_x[0][1];P_x[1][0]-=K_x[1]*P_x[0][0];P_x[1][1]-=K_x[1]*P_x[0][1];return(angle_x);//}};varkalmanFilterY=function(newAngle_y,newRate_y){console.log(y_first_pass);/*if(y_first_pass){//angle_y=newAngle_y;console.log(newAngle_y);y_first_pass=false;return(angle_y);}else{**//*Step1*/rate_y=newRate_y-bias_y;angle_y=angle_y+(dt1*rate_y);//console.log("P00:"+P_y[0/*Step2*/P_y[0][0]+=dt1*(dt1*P_y[1][1]-P_y[0][1]-P_y[1][0]+Q_angle_y);P_y[0][1]-=dt1*P_y[1][1];P_y[1][0]-=dt1*P_y[1][1];P_y[1][1]+=Q_bias_y*dt1;/*Step3*/y_y=newAngle_y-angle_y;/*Step4*/S_y=P_y[0][0]+R_measure_y;/*Step5*/K_y[0]=P_y[0][0]/S_y;K_y[1]=P_y[1][0]/S_y;y_y=newAngle_y-angle_y;/*Step6*/angle_y+=K_y[0]*y_y;bias_y+=K_y[1]*y_y;/*Step7*/P_y[0][0]-=K_y[0]*P_y[0][0];P_y[0][1]-=K_y[0]*P_y[0][1];P_y[1][0]-=K_y[1]*P_y[0][0];P_y[1][1]-=K_y[1]*P_y[0][1];return(angle_y);//}};};
                    </script>
</body>

</html>
